# 产品需求文档 - 汇仁药业低代码平台

## 文档信息

| 项目 | 内容 |
|------|------|
| 产品名称 | 汇仁药业智能制造低代码平台 |
| 版本 | v2.0 |
| 负责人 | Product Manager |
| 创建时间 | 2025-12-11 |
| 更新时间 | 2025-12-11 |
| 状态 | 调整中 |

---

## 1. 概述与背景

### 1.1 企业背景
- **企业名称**：汇仁药业
- **企业类型**：中成药制造企业（OTC）
- **发展方向**：智能制造
- **企业规模**：1400员工，400亩厂区
- **核心产品**：肾宝片、六味地黄丸、乌鸡白凤丸等中成药

### 1.2 问题陈述
1. **多系统数据孤岛**：MES、QMS、WMS、ERP、OA、CRM 六大系统数据未打通
2. **人员管理缺失**：缺乏统一的 OKR 与绩效管理体系
3. **制药业务特殊性**：质量管理（QMS）是核心，需要严格的流程与审计
4. **低代码能力展示**：需要演示平台的表单、工作流、页面设计器等核心能力

### 1.3 目标
- **业务目标**：实现多系统数据聚合与可视化，建立 OKR 驱动的绩效管理体系
- **技术目标**：展示低代码平台的核心能力：数据对接、流程编排、页面快速搭建
- **非目标**：不替代现有六大系统；不实现复杂的制药工艺流程

### 1.4 成功度量
- **演示效果**：3个核心场景流程完整演示（≤15分钟）
- **系统对接**：6个外部系统数据源配置完整展示（占位即可）
- **低代码能力**：表单/工作流/页面设计器可操作演示

---

## 2. 角色与场景

### 2.1 核心角色

| 角色 | 描述 | 关注点 |
|------|------|--------|
| **系统管理员** | IT部门负责人 | 数据源配置、系统对接、权限管理 |
| **部门经理** | 生产/质量/仓储部门管理者 | OKR 管理、绩效评估、异常处理 |
| **HR 管理员** | 人力资源部 | 绩效周期管理、考核数据导出 |
| **普通员工** | 车间班组长、质检员、仓管员 | OKR 执行、异常工单提报 |
| **高层领导** | 总经理/副总经理 | 运营总览、跨系统数据分析 |

### 2.2 典型场景

#### 场景 1：OKR + 绩效管理全流程
**参与者**：员工、部门经理、HR
**步骤**：
1. HR 创建季度绩效周期
2. 员工创建 OKR（Objective + Key Results）
3. 部门经理审批 OKR
4. 员工定期更新 KR 进度
5. 季度末：绩效评估 + OKR 完成度自动计算
6. HR 导出绩效数据

#### 场景 2：生产 + 质量管理联动
**参与者**：车间班组长、质检员、部门经理
**步骤**：
1. 车间班组长发现生产异常，提报工单
2. 工单通过工作流引擎流转到质检部门
3. 质检员从 QMS 调取批次数据，判断是否需要停产
4. 部门经理查看异常统计看板，发现质量趋势
5. Debug 窗口展示：工单流转日志、QMS 数据查询记录

#### 场景 3：多系统数据聚合展示
**参与者**：高层领导、系统管理员
**步骤**：
1. 系统管理员配置 6 个数据源（MES/QMS/WMS/ERP/OA/CRM）
2. 数据血缘图展示：各系统数据如何流向低代码平台
3. 运营总览大屏：实时展示生产进度（MES）、质量指标（QMS）、库存（WMS）、订单（ERP）
4. KPI 指标字典：定义"合格率""按时交付率"等口径

---

## 3. 核心功能（按优先级排序）

### P0 - 演示核心（明天必须能演示）

#### 3.1 运营总览大屏 ✓
**路径**：`/overview`
**功能**：
- 六大系统数据聚合展示（卡片 + 图表）
- 核心 KPI：今日产量、合格率、库存预警、待处理工单
- 占位展示：MES、QMS、WMS、ERP、OA、CRM 连接状态
- 实时刷新逻辑（模拟）

**改造方向**：
- 删除原有的"客户360视图"和"销售漏斗"等不相关业务
- 新增制药行业核心指标卡片
- 新增"系统连接状态"模块

#### 3.2 OKR 管理 ✓
**路径**：`/okr`、`/okr/create`、`/okr/:id`
**功能**：
- OKR 列表（按部门/状态筛选）
- 创建 OKR（富文本编辑器 + Key Results 动态添加）
- OKR 详情（进度更新、评论、审批流）
- 与绩效管理联动

**保留理由**：PRD 明确要求的核心功能

#### 3.3 绩效管理 ✓
**路径**：`/performance`、`/performance/period`
**功能**：
- 绩效周期管理（季度/年度）
- 绩效评估（OKR 完成度自动计算 + 主管评分）
- 绩效数据导出
- 权限控制（HR/经理/员工）

**保留理由**：PRD 明确要求的核心功能

#### 3.4 数据源配置 ✓
**路径**：`/datasource`、`/datasource/config/:id?`
**功能**：
- 六大系统数据源配置界面（占位）
- 连接测试（模拟成功/失败）
- 数据源类型：PostgreSQL、MySQL、REST API、OData
- 配置项：主机、端口、数据库、用户名、密码、API Endpoint

**占位展示**：
- MES（生产执行系统）：REST API
- QMS（质量管理系统）：PostgreSQL
- WMS（仓储管理系统）：MySQL
- ERP（企业资源计划）：OData
- OA（办公自动化）：REST API
- CRM（客户关系管理）：REST API

#### 3.5 生产异常工单 ✓（需改造）
**路径**：`/scenarios/workorder`
**功能**：
- 工单列表（按状态筛选）
- 创建工单（表单设计器生成）
- 工单详情（流转记录 + 处理意见）
- 工作流引擎驱动（车间 → 质检 → 经理审批）

**改造方向**：
- 增加与 MES/QMS 的联动展示
- Debug 窗口展示工单流转日志

---

### P1 - 低代码能力展示（可简化）

#### 3.6 表单设计器 ✓
**路径**：`/lowcode/form-designer`
**功能**：
- 拖拽式表单设计
- 组件库：输入框、下拉框、日期选择、文件上传、表格
- 字段校验规则配置
- 表单预览 + JSON Schema 导出

**演示建议**：快速拖拽一个"费用报销表单"

#### 3.7 工作流设计器 ✓
**路径**：`/lowcode/workflow-designer`
**功能**：
- 可视化流程编排（开始节点 → 审批节点 → 结束节点）
- 审批人配置（固定人员/部门经理/HR）
- 条件分支（金额 > 1000 需要总经理审批）
- 流程实例监控

**演示建议**：展示"生产异常工单"的审批流程

#### 3.8 页面构建器 ✓
**路径**：`/lowcode/page-builder`
**功能**：
- 拖拽式页面布局
- 组件库：表格、图表、卡片、表单、按钮
- 数据绑定（连接数据源 API）
- 页面发布

**演示建议**：快速搭建一个"质量日报"页面

#### 3.9 API 管理 ✓
**路径**：`/lowcode/api-management`
**功能**：
- API 列表（已配置的数据源 API）
- API 测试（模拟请求 + 响应展示）
- 参数配置
- 调用日志

---

### P2 - 数据治理（可占位）

#### 3.10 数据血缘 ✓
**路径**：`/datasource/lineage`
**功能**：
- 可视化数据流向图
- 源系统 → 低代码平台 → 目标应用
- 点击节点查看数据表结构

**占位展示**：
```
MES → [生产数据表] → 运营总览大屏
QMS → [质量数据表] → 质量日报页面
```

#### 3.11 数据同步任务 ✓
**路径**：`/datasync`
**功能**：
- 同步任务列表（定时/实时）
- 同步策略：全量/增量
- 同步状态：成功/失败/执行中
- 执行日志

#### 3.12 KPI 指标字典 ✓
**路径**：`/kpi/dict`
**功能**：
- 指标列表（名称、口径、来源系统、刷新频率）
- 指标详情（计算公式、责任部门）
- 权限控制（管理员/经理可见）

**示例指标**：
- **今日产量**：来源 MES，刷新频率 2 小时
- **合格率**：来源 QMS，计算公式（合格批次/总批次）× 100%
- **库存周转率**：来源 WMS，计算公式（出库金额/平均库存）× 365

---

### P3 - 其他场景（可删除/简化）

#### 3.13 费用报销 ?（待评估）
**路径**：`/scenarios/expense`
**功能**：
- 报销单填写（表单设计器生成）
- 审批流程（工作流引擎驱动）

**建议**：保留作为"低代码工具"演示案例，删除复杂的财务逻辑

#### 3.14 客户360视图 ❌（建议删除）
**路径**：`/scenarios/customer360`
**原因**：汇仁药业是 B2B2C 模式（经销商 + 终端消费者），不适合"客户360"概念

**替代方案**：改为"经销商画像"（来源 CRM + ERP）

#### 3.15 销售漏斗仪表板 ❌（建议删除）
**路径**：`/scenarios/sales-funnel`
**原因**：制药企业不适合"销售漏斗"模型（非直销）

**替代方案**：改为"订单履约看板"（来源 ERP + WMS）

---

## 4. 数据与口径

### 4.1 关键字段来源表

| 字段名称 | 来源系统 | 刷新频率 | 计算规则 | 异常口径 |
|---------|---------|---------|---------|---------|
| 今日产量 | MES | 2 小时 | 当日完成批次数量总和 | 停机状态不计入 |
| 合格率 | QMS | 1 小时 | （合格批次/总批次）× 100% | 复检通过计为合格 |
| 库存预警数 | WMS | 4 小时 | 库存量 < 安全库存的品种数 | 包含在途库存 |
| 待处理工单 | 低代码平台 | 实时 | 状态为"待处理"的工单数 | - |
| OKR 完成度 | 低代码平台 | 实时 | 所有 KR 进度的加权平均 | 未开始视为 0% |

### 4.2 系统对接占位方案

| 系统 | 对接方式 | 展示数据 | 占位说明 |
|-----|---------|---------|---------|
| **MES** | REST API | 生产进度、设备状态、产量统计 | 配置页面显示 Endpoint，实际数据 Mock |
| **QMS** | PostgreSQL | 批次检验记录、不合格品统计 | 配置页面显示连接参数，实际数据 Mock |
| **WMS** | MySQL | 库存余额、出入库流水 | 配置页面显示连接参数，实际数据 Mock |
| **ERP** | OData | 订单数据、采购数据、财务数据 | 配置页面显示 Service Root，实际数据 Mock |
| **OA** | REST API | 审批流程、会议通知 | 配置页面显示 API Token，实际数据 Mock |
| **CRM** | REST API | 经销商信息、销售数据 | 配置页面显示 API Key，实际数据 Mock |

---

## 5. 非功能需求

### 5.1 性能
- **页面加载**：首屏加载时间 < 2 秒（本地环境）
- **数据刷新**：图表数据刷新 < 500ms
- **并发**：支持 10 个用户同时操作（演示环境）

### 5.2 安全
- **权限控制**：RBAC（员工/经理/HR/管理员/领导）
- **数据脱敏**：敏感字段（手机号、身份证）脱敏展示
- **审计日志**：关键操作留痕（数据源配置、OKR 审批、绩效评分）

### 5.3 可用性
- **响应式布局**：支持 1920×1080、1440×900 分辨率
- **打印功能**：OKR 详情、绩效报表支持打印
- **Debug 窗口**：右下角浮动窗口，实时展示后台流程日志

### 5.4 合规
- **GMP 规范**：质量数据不可修改（仅可追加审计记录）
- **数据留痕**：OKR 修改历史、绩效评分历史

---

## 6. 里程碑

| 里程碑 | 时间 | 交付物 | 验收标准 |
|-------|------|--------|---------|
| **M1** | 2025-12-12 | 演示环境就绪 | 3 个核心场景可完整演示 |
| **M2** | 2025-12-20 | 系统对接方案确认 | 6 个系统占位展示完整 |
| **M3** | 2026-01-15 | 第一期上线 | OKR + 绩效管理可正式使用 |

---

## 7. 变更记录

| 日期 | 版本 | 变更内容 | 变更人 |
|------|------|---------|--------|
| 2025-12-11 | v2.0 | 重构产品结构，对齐汇仁药业制药业务 | PM |
| - | - | 删除"客户360"和"销售漏斗"，新增"经销商画像"和"订单履约看板" | PM |
| - | - | 明确 6 个系统占位展示方案 | PM |

---

## 8. 附录

### 8.1 技术栈
- **前端**：Vue 3 + Vite + Ant Design Vue + ECharts
- **后端**：Node.js + Koa（未实现）
- **数据库**：PostgreSQL（未实现）
- **部署**：本地开发环境（Windows）

### 8.2 参考文档
- 《GMP 药品生产质量管理规范》
- 《制药行业 MES 系统建设指南》
- 《低代码平台产品白皮书》

### 8.3 待澄清事项
1. 是否需要实现真实的 MES/QMS 对接（还是占位即可）？
2. OKR 审批流程是否需要多级审批？
3. 绩效评分算法是否需要自定义权重？
4. Debug 窗口展示哪些具体日志（建议：API 调用、工作流流转、数据同步）？

---

**文档结束**
