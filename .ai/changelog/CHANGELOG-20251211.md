# 变更记录 - 2025-12-11

## 文档信息

| 项目 | 内容 |
|------|------|
| 版本 | v2.0 |
| 变更日期 | 2025-12-11 |
| 变更人 | Product Manager |

---

## 1. 变更来源

### 需求方
- **业务部门**：汇仁药业管理层
- **演示场景**：低代码平台能力展示（明天演示）

### 需求文档
- **标题**：汇仁药业低代码平台演示需求
- **核心诉求**：
  1. OKR + 绩效管理（人员管理核心）
  2. 多系统数据聚合展示（低代码平台价值）
  3. 数据源配置能力（系统对接能力）
  4. 低代码工具展示（表单/工作流/页面设计器）
  5. Debug窗口（展示后台流程）

### 背景
- **企业类型**：中成药制造企业（OTC），智能制造方向
- **规模**：1400员工，400亩厂区
- **核心产品**：肾宝片、六味地黄丸、乌鸡白凤丸
- **关键系统**：MES、QMS、WMS、ERP、OA、CRM

---

## 2. 变更点

### 2.1 删除页面（2个）

| 页面 | 路由 | 删除原因 |
|------|------|---------|
| **客户360视图** | `/scenarios/customer360` | 汇仁药业是B2B2C模式（经销商 + 终端消费者），不适合"客户360"概念 |
| **销售漏斗仪表板** | `/scenarios/sales-funnel` | 制药企业不适合"销售漏斗"模型（非直销） |

**替代方案**：
- 新增"经销商画像"（`/supply/dealer`，P2优先级）
- 新增"订单履约看板"（`/supply/order`，P2优先级）

---

### 2.2 调整页面（2个）

#### 2.2.1 运营总览大屏（`/overview`）

**调整内容**：
1. **新增模块**：
   - 六大系统连接状态（MES、QMS、WMS、ERP、OA、CRM）
   - 核心指标卡片（今日产量、合格率、库存预警、待处理工单）
   - 生产趋势图（最近7天产量）
   - 质量趋势图（最近7天合格率）
   - 异常工单统计（饼图）
   - 库存分布图（雷达图）

2. **删除模块**：
   - 原有的通用业务指标（销售额、客户数等）

**数据来源**：
- MES：今日产量、生产趋势
- QMS：合格率、质量趋势
- WMS：库存预警、库存分布
- 低代码平台：待处理工单、异常工单统计

---

#### 2.2.2 生产异常工单（`/production/workorder`）

**调整内容**：
1. **路由变更**：
   - 原路由：`/scenarios/workorder`
   - 新路由：`/production/workorder`
   - 文件移动：`Scenarios/ProductionWorkOrder.vue` → `Production/ProductionWorkOrder.vue`

2. **功能增强**：
   - 新增"流转记录时间轴"（展示工单生命周期）
   - 新增"关联QMS数据"按钮（占位，模拟API调用）
   - 新增"批次追溯"链接（点击批次号跳转到 `/quality/traceability`）

3. **Debug窗口联动**：
   - 工单创建时打印日志
   - QMS数据查询时打印API调用日志
   - 工作流流转时打印流转记录

---

### 2.3 新增页面（8个）

#### P1 - 建议快速新增（3个）

| 页面 | 路由 | 功能 | 数据来源 |
|------|------|------|---------|
| **生产进度看板** | `/production/progress` | 实时产线状态、当前批次、完成率 | MES（占位） |
| **质量检验工单** | `/quality/inspection` | 检验工单列表、检验详情、不合格项处理 | QMS（占位） |
| **库存预警** | `/supply/inventory` | 预警列表、库存趋势图、采购建议 | WMS（占位） |

#### P2 - 占位展示（5个）

| 页面 | 路由 | 占位内容 |
|------|------|---------|
| **设备状态监控** | `/production/equipment` | 显示"功能开发中" + 设备列表（模拟数据） |
| **不合格品统计** | `/quality/defect` | 显示"功能开发中" + 不合格品趋势图（模拟数据） |
| **批次追溯** | `/quality/traceability` | 显示"功能开发中" + 批次追溯流程图（模拟数据） |
| **订单履约看板** | `/supply/order` | 显示"功能开发中" + 订单状态统计（模拟数据） |
| **经销商画像** | `/supply/dealer` | 显示"功能开发中" + 经销商列表（模拟数据） |

---

### 2.4 导航菜单调整（`Dashboard.vue`）

**调整前（6个分组）**：
```
- 运营总览
- OKR管理
- 绩效管理
- 数据管理
- 低代码工具
- 业务场景（客户360、销售漏斗、费用报销、生产工单）
```

**调整后（8个分组）**：
```
- 运营总览
- OKR与绩效（OKR管理、绩效管理、绩效周期管理）
- 生产管理（生产异常工单、生产进度看板、设备状态监控）
- 质量管理（质量检验工单、不合格品统计、批次追溯）
- 供应链管理（库存预警、订单履约看板、经销商画像）
- 数据集成（数据源配置、数据血缘、数据同步任务、KPI指标字典）
- 低代码工具（表单设计器、工作流设计器、页面构建器、API管理、应用市场）
- 其他场景（费用报销）
```

---

## 3. 影响范围

### 3.1 接口影响
- **新增API**：无（未实现后端）
- **修改API**：无
- **废弃API**：无

---

### 3.2 字段影响

#### 新增表（3个）

| 表名 | 说明 | 关键字段 |
|------|------|---------|
| `production_data` | MES生产数据（占位） | production_line, batch_no, completed_quantity, target_quantity |
| `quality_data` | QMS质量数据（占位） | batch_no, inspection_type, result, quality_rate |
| `inventory_data` | WMS库存数据（占位） | product_name, quantity, safety_stock, alert_level |

#### 新增字段（1个）

| 表名 | 字段名 | 类型 | 说明 |
|------|--------|------|------|
| `production_workorder` | `batch_no` | VARCHAR(20) | 批次号（关联MES/QMS） |

---

### 3.3 UI影响

| 页面 | 变更内容 |
|------|---------|
| **运营总览** | 完全重构（新增6个系统状态 + 4个指标卡片 + 4个图表） |
| **生产异常工单** | 新增流转时间轴、关联QMS数据按钮 |
| **导航菜单** | 调整分组结构（6组 → 8组） |

---

### 3.4 报表影响

| 报表 | 变更内容 |
|------|---------|
| **生产趋势图** | 新增（最近7天产量，折线图） |
| **质量趋势图** | 新增（最近7天合格率,柱状图） |
| **异常工单统计** | 新增（按类型分布，饼图） |
| **库存分布图** | 新增（各品种库存占比，雷达图） |

---

## 4. 后续动作

### 4.1 立即执行（今晚，2025-12-11 20:00前）

| 任务 | 负责人 | 预计时长 | 状态 |
|------|--------|---------|------|
| 确认技术选型（PostgreSQL版本、Koa版本） | Backend | 0.5小时 | ⚪ 未开始 |
| 开始OpenAPI契约编写 | Backend | 2小时 | ⚪ 未开始 |
| 开始设计规范编写 | Designer | 2小时 | ⚪ 未开始 |
| 前端准备开发环境 | Frontend | 0.5小时 | ⚪ 未开始 |

---

### 4.2 明天上午（2025-12-12 08:00 - 12:00）

| 任务 | 负责人 | 预计时长 | 状态 |
|------|--------|---------|------|
| P0页面改造（运营总览、生产工单、导航菜单） | Frontend | 4小时 | ⚪ 未开始 |
| Debug窗口开发 | Frontend | 2小时 | ⚪ 未开始 |
| Mock数据准备 | Frontend | 1小时 | ⚪ 未开始 |

---

### 4.3 明天下午（2025-12-12 14:00 - 17:00）

| 任务 | 负责人 | 预计时长 | 状态 |
|------|--------|---------|------|
| 演示彩排（走通3个场景） | All | 1小时 | ⚪ 未开始 |
| Bug修复与优化 | Frontend | 2小时 | ⚪ 未开始 |
| 演示脚本确认 | PM | 0.5小时 | ⚪ 未开始 |

---

## 5. 兼容性与风险

### 5.1 兼容期
- **无需兼容期**（新系统，无历史用户）

---

### 5.2 风险

| 风险项 | 影响 | 概率 | 应对措施 |
|-------|------|------|---------|
| 时间紧迫（明天演示） | 高 | 高 | 优先完成P0任务，P1/P2占位展示 |
| 设计稿未完成 | 中 | 中 | 前端先用现有组件占位 |
| 后端未实现 | 高 | 高 | 前端使用Mock数据，展示数据源配置界面 |
| Debug窗口干扰演示 | 低 | 低 | 设计为可收起，默认展开 |

---

## 6. 文档更新

### 6.1 已更新文档

| 文档 | 路径 | 更新内容 |
|------|------|---------|
| **PRD** | `.ai/prd.md` | 重构产品结构，对齐汇仁药业制药业务 |
| **流程设计** | `.ai/flows.md` | 新增3个核心演示场景流程 |
| **页面调整方案** | `.ai/pages-adjustment.md` | 明确删除/调整/新增页面清单 |
| **字段字典** | `.ai/dictionary.md` | 新增MES/QMS/WMS数据表定义 |
| **KPI指标字典** | `.ai/kpi.md` | 新增21个制药行业KPI指标 |
| **约定规范** | `.ai/convention.md` | 明确命名/目录/文档/提交规范 |
| **进度跟踪** | `.ai/progress.md` | 记录跨Agent交接与推进 |
| **验收标准** | `.ai/acceptance.md` | 新增3个核心场景的BDD验收标准 |
| **变更记录** | `.ai/changelog/CHANGELOG-20251211.md` | 本文档 |

---

### 6.2 待更新文档

| 文档 | 路径 | 更新内容 | 负责人 | 预计时间 |
|------|------|---------|--------|---------|
| **OpenAPI契约** | `docs/api/openapi.yaml` | 定义所有API接口 | Backend | 2025-12-11 22:00 |
| **设计规范** | `docs/DESIGN_GUIDE.md` | 栅格/主题/组件库 | Designer | 2025-12-11 22:00 |
| **测试报告** | `docs/test-report.md` | 功能/性能/兼容性测试结果 | QA | 2025-12-13 |

---

## 7. 审批与确认

| 角色 | 姓名 | 确认时间 | 签名 |
|------|------|---------|------|
| **需求方** | 汇仁药业管理层 | - | - |
| **产品经理** | PM | 2025-12-11 | ✅ |
| **技术负责人** | Backend Leader | - | - |
| **设计负责人** | Designer Leader | - | - |

---

**文档结束**
